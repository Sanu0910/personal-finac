<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>City-Based Personal Finance Planner (India) — with Lumpsum & LIC vs MF</title>

  <!-- UI + Fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    html, body { height: 100%; }
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", sans-serif; }
  </style>

  <!-- React (UMD) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

  <!-- Chart.js (UMD global: window.Chart) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- jsPDF (UMD global: window.jspdf.jsPDF via window.jspdf) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin></script>
</head>
<body class="bg-slate-50 text-slate-900">
  <div id="root"></div>

  <script type="text/javascript">
    // ------------------------------
    // Utility & constants
    // ------------------------------
    const { useEffect, useMemo, useRef, useState } = React;
    const INR = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 });

    const CITY_PRESETS = {
      Bangalore: {
        defaultIncome: 80000,
        expenses: { Rent: 22000, Transport: 3000, Food: 9000, Utilities: 4000, Healthcare: 2500, Entertainment: 3500, "Education/Fees": 0, Misc: 2500 }
      },
      Delhi: {
        defaultIncome: 75000,
        expenses: { Rent: 18000, Transport: 2500, Food: 8000, Utilities: 3500, Healthcare: 2500, Entertainment: 3000, "Education/Fees": 0, Misc: 2500 }
      },
      Mumbai: {
        defaultIncome: 90000,
        expenses: { Rent: 30000, Transport: 2500, Food: 9500, Utilities: 4000, Healthcare: 3000, Entertainment: 4000, "Education/Fees": 0, Misc: 3000 }
      },
      Kolkata: {
        defaultIncome: 65000,
        expenses: { Rent: 12000, Transport: 2000, Food: 7000, Utilities: 3000, Healthcare: 2000, Entertainment: 2500, "Education/Fees": 0, Misc: 2000 }
      }
    };

    const COLORS = [
      '#0ea5e9', '#22c55e', '#f97316', '#a78bfa', '#ef4444', '#14b8a6', '#f59e0b', '#8b5cf6', '#10b981'
    ];

    // ------------------------------
    // Math helpers
    // ------------------------------
    function monthlyRate(annualPct){ return (+(annualPct||0)/100)/12; }

    function sipFutureValue(monthly, years, annualReturnPct) {
      const n = Math.max(0, Math.round((+years || 0) * 12));
      const r = monthlyRate(annualReturnPct);
      if (n === 0) return 0;
      if (r === 0) return (+monthly || 0) * n;
      // FV of annuity due: monthly * [((1+r)^n - 1)/r] * (1+r)
      return (+monthly || 0) * (((Math.pow(1 + r, n) - 1) / r) * (1 + r));
    }

    function lumpsumFutureValue(principal, years, annualReturnPct){
      const n = Math.max(0, Math.round((+years || 0) * 12));
      const r = monthlyRate(annualReturnPct);
      return (+principal || 0) * Math.pow(1+r, n);
    }

    function contributionSeries(monthly, years, annualReturnPct) {
      const r = monthlyRate(annualReturnPct);
      const months = Math.max(0, Math.round((+years || 0) * 12));
      const data = [];
      let fv = 0;
      for (let m = 0; m <= months; m += 6) { // every 6 months
        if (m === 0) { data.push({ label: '0', invested: 0, value: 0 }); continue; }
        fv = 0;
        for (let k = 1; k <= m; k++) {
          fv = (fv + (+monthly || 0)) * (1 + r);
        }
        data.push({ label: `${(m/12).toFixed(1)}y`, invested: (+monthly || 0) * m, value: fv });
      }
      return data;
    }

    function contributionSeriesStepUp(startMonthly, years, annualReturnPct, stepUpPct){
      const r = monthlyRate(annualReturnPct);
      const months = Math.max(0, Math.round((+years || 0) * 12));
      const data = [];
      let fv = 0, mth = +startMonthly||0, invested=0;
      // simulate month-by-month; capture points every 6 months
      for (let k = 0; k <= months; k++){
        if (k === 0){
          data.push({ label: '0', invested: 0, value: 0 });
          continue;
        }
        // step up at month 13, 25, ...
        if (k>1 && (k-1)%12 === 0){ mth = mth * (1 + (+stepUpPct||0)/100); }
        invested += mth;
        fv = (fv + mth) * (1 + r);
        if (k % 6 === 0){
          data.push({ label: `${(k/12).toFixed(1)}y`, invested, value: fv });
        }
      }
      return data;
    }

    function lumpsumSeries(principal, years, annualReturnPct){
      const r = monthlyRate(annualReturnPct);
      const months = Math.max(0, Math.round((+years || 0) * 12));
      const data = [];
      for (let m = 0; m <= months; m += 6){
        const value = (+principal || 0) * Math.pow(1+r, m);
        data.push({ label: m===0? '0' : `${(m/12).toFixed(1)}y`, invested: (+principal||0), value });
      }
      return data;
    }

    function realFV(nominalFV, inflPct, years){
      return nominalFV / Math.pow(1 + (+inflPct||0)/100, +years||0);
    }
    function goalFutureCost(presentCost, years, inflPct){
      return (+presentCost||0) * Math.pow(1 + (+inflPct||0)/100, +years||0);
    }
    function monthlyForGoal(futureCost, years, annualReturnPct){
      const n = Math.max(1, Math.round((+years||0)*12));
      const r = monthlyRate(+annualReturnPct||0);
      if (r === 0) return futureCost / n; // no-growth fallback
      // annuity-due: FV = M * [((1+r)^n - 1)/r] * (1+r)
      return futureCost / (((Math.pow(1+r, n) - 1) / r) * (1+r));
    }
    function sipStepUpFutureValue(startMonthly, years, annualReturnPct, stepUpPct){
      const n = Math.max(0, Math.round((+years||0)*12));
      const r = monthlyRate(annualReturnPct);
      let fv = 0, m = +startMonthly||0;
      for (let k = 1; k <= n; k++){
        if (k>1 && (k-1)%12 === 0){ m = m * (1 + (+stepUpPct||0)/100); }
        fv = (fv + m) * (1 + r);
      }
      return fv;
    }
    function investedStepUp(startMonthly, years, stepUpPct){
      const n = Math.max(0, Math.round((+years||0)*12));
      let total = 0, m = +startMonthly||0;
      for (let k = 1; k <= n; k++){
        if (k>1 && (k-1)%12 === 0){ m = m * (1 + (+stepUpPct||0)/100); }
        total += m;
      }
      return Math.round(total);
    }

    // ------------------------------
    // Local storage hook
    // ------------------------------
    function useLocalStorage(key, initial) {
      const [state, setState] = useState(() => {
        try {
          const raw = localStorage.getItem(key);
          return raw ? JSON.parse(raw) : (typeof initial === 'function' ? initial() : initial);
        } catch { return (typeof initial === 'function' ? initial() : initial); }
      });
      useEffect(() => { try { localStorage.setItem(key, JSON.stringify(state)); } catch {} }, [key, state]);
      return [state, setState];
    }

    // ------------------------------
    // Chart.js React wrappers
    // ------------------------------
    function PieChartBox({ labels, values }) {
      const canvasRef = useRef(null);
      const chartRef = useRef(null);
      useEffect(() => {
        if (!window.Chart) return;
        const ctx = canvasRef.current.getContext('2d');
        if (chartRef.current) chartRef.current.destroy();
        chartRef.current = new Chart(ctx, {
          type: 'doughnut',
          data: { labels, datasets: [{ data: values, backgroundColor: COLORS, borderWidth: 0 }] },
          options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
        });
        return () => chartRef.current && chartRef.current.destroy();
      }, [labels.join('|'), values.join('|')]);
      return React.createElement('div', { className: 'h-72' }, React.createElement('canvas', { ref: canvasRef }));
    }

    function LineCompareChart({ labels, seriesList }){
      const canvasRef = useRef(null);
      const chartRef = useRef(null);
      useEffect(() => {
        if (!window.Chart) return;
        const ctx = canvasRef.current.getContext('2d');
        if (chartRef.current) chartRef.current.destroy();
        chartRef.current = new Chart(ctx, {
          type: 'line',
          data: {
            labels,
            datasets: seriesList.map(s => ({ label: s.label, data: s.values, tension: 0.25 }))
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { ticks: { callback: (v) => INR.format(v) } } },
            plugins: { legend: { position: 'bottom' }, tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${INR.format(ctx.parsed.y)}` } } }
          }
        });
        return () => chartRef.current && chartRef.current.destroy();
      }, [labels.join('|'), JSON.stringify(seriesList.map(s=>s.values))]);
      return React.createElement('div', { className: 'h-80' }, React.createElement('canvas', { ref: canvasRef }));
    }

    // ------------------------------
    // App
    // ------------------------------
    function App() {
      const [city, setCity] = useLocalStorage('pf-city', 'Bangalore');
      const [income, setIncome] = useLocalStorage('pf-income', CITY_PRESETS[city].defaultIncome);
      const [expenses, setExpenses] = useLocalStorage('pf-expenses', CITY_PRESETS[city].expenses);
      const [sipPct, setSipPct] = useLocalStorage('pf-sipPct', 20);
      const [mfReturnPct, setMfReturnPct] = useLocalStorage('pf-mf-returnPct', 12);
      const [licIrrPct, setLicIrrPct] = useLocalStorage('pf-lic-irrPct', 5);
      const [years, setYears] = useLocalStorage('pf-years', 20);
      const [mode, setMode] = useLocalStorage('pf-mode', 'SIP'); // 'SIP' | 'Lumpsum'
      const [lumpsumAmount, setLumpsumAmount] = useLocalStorage('pf-lumpsum', 2000000);

      // New features state
      const [inflPct, setInflPct] = useLocalStorage('pf-infl', 6);
      const [efMonths, setEfMonths] = useLocalStorage('pf-ef-months', 6);
      const [useStepUp, setUseStepUp] = useLocalStorage('pf-useStepUp', false);
      const [stepUpPct, setStepUpPct] = useLocalStorage('pf-stepUpPct', 10);
      const [goals, setGoals] = useLocalStorage('pf-goals', []);

      useEffect(() => {
        // When city changes, seed defaults but keep user edits unless Reset is pressed
        setIncome((prev) => prev || CITY_PRESETS[city].defaultIncome);
        setExpenses((prev) => prev || CITY_PRESETS[city].expenses);
      }, [city]);

      const totalExpenses = useMemo(() => Object.values(expenses).reduce((a,b) => a + (+b || 0), 0), [expenses]);
      const sipMonthly = useMemo(() => Math.round((+income || 0) * (+sipPct || 0) / 100), [income, sipPct]);
      const leftover = useMemo(() => Math.round((+income || 0) - totalExpenses - sipMonthly), [income, totalExpenses, sipMonthly]);

      // FV numbers
      const sipFvMF = useMemo(() => Math.round(sipFutureValue(sipMonthly, +years || 0, +mfReturnPct || 0)), [sipMonthly, years, mfReturnPct]);
      const sipFvLIC = useMemo(() => Math.round(sipFutureValue(sipMonthly, +years || 0, +licIrrPct || 0)), [sipMonthly, years, licIrrPct]);
      const lumpFvMF = useMemo(() => Math.round(lumpsumFutureValue(lumpsumAmount, +years || 0, +mfReturnPct || 0)), [lumpsumAmount, years, mfReturnPct]);
      const lumpFvLIC = useMemo(() => Math.round(lumpsumFutureValue(lumpsumAmount, +years || 0, +licIrrPct || 0)), [lumpsumAmount, years, licIrrPct]);

      // Real FV (inflation-adjusted)
      const realSipFvMF = useMemo(
        () => Math.round(realFV(sipFvMF, inflPct, +years||0)),
        [sipFvMF, inflPct, years]
      );

      // Step-up SIP FV and invested
      const sipFvMF_stepUp = useMemo(() => useStepUp
        ? Math.round(sipStepUpFutureValue(sipMonthly, +years||0, +mfReturnPct||0, +stepUpPct||0))
        : sipFvMF,
        [useStepUp, sipMonthly, years, mfReturnPct, stepUpPct, sipFvMF]
      );

      const investedSipFlat = useMemo(() => sipMonthly * (years*12), [sipMonthly, years]);
      const investedSipDisplay = useMemo(() => useStepUp ? investedStepUp(sipMonthly, years, stepUpPct) : investedSipFlat, [useStepUp, sipMonthly, years, stepUpPct, investedSipFlat]);

      // Series for comparison chart
      const sipSeriesMF = useMemo(() => contributionSeries(sipMonthly, +years || 0, +mfReturnPct || 0), [sipMonthly, years, mfReturnPct]);
      const sipSeriesMF_stepUp = useMemo(() => useStepUp
        ? contributionSeriesStepUp(sipMonthly, +years||0, +mfReturnPct||0, +stepUpPct||0)
        : sipSeriesMF,
        [useStepUp, sipMonthly, years, mfReturnPct, stepUpPct, sipSeriesMF]
      );
      const sipSeriesLIC = useMemo(() => contributionSeries(sipMonthly, +years || 0, +licIrrPct || 0), [sipMonthly, years, licIrrPct]);
      const lumpSeriesMF = useMemo(() => lumpsumSeries(lumpsumAmount, +years || 0, +mfReturnPct || 0), [lumpsumAmount, years, mfReturnPct]);
      const lumpSeriesLIC = useMemo(() => lumpsumSeries(lumpsumAmount, +years || 0, +licIrrPct || 0), [lumpsumAmount, years, licIrrPct]);

      const compLabels = (mode === 'SIP' ? sipSeriesMF_stepUp : lumpSeriesMF).map(d => d.label);
      const compMFVals = (mode === 'SIP' ? sipSeriesMF_stepUp : lumpSeriesMF).map(d => Math.round(d.value));
      const compLICVals = (mode === 'SIP' ? sipSeriesLIC : lumpSeriesLIC).map(d => Math.round(d.value));

      const pieData = useMemo(() => Object.entries(expenses).map(([k, v]) => ({ name: k, value: +v || 0 })), [expenses]);
      const pieLabels = pieData.map(d => d.name);
      const pieValues = pieData.map(d => d.value);

      function resetToCity() {
        const preset = CITY_PRESETS[city];
        setIncome(preset.defaultIncome);
        setExpenses(preset.expenses);
      }

      function addCategory() {
        const name = prompt('New expense category name');
        if (!name) return;
        setExpenses({ ...expenses, [name]: 0 });
      }

      function exportJSON() {
        const payload = { city, income, expenses, sipPct, mfReturnPct, licIrrPct, years, mode, lumpsumAmount, inflPct, efMonths, useStepUp, stepUpPct, goals, generatedAt: new Date().toISOString() };
        const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `finance-plan-${city}.json`; a.click();
        URL.revokeObjectURL(url);
      }

      function importJSON(){
        const inp = document.createElement('input');
        inp.type = 'file'; inp.accept = 'application/json';
        inp.onchange = (e) => {
          const file = e.target.files?.[0]; if(!file) return;
          const reader = new FileReader();
          reader.onload = () => {
            try {
              const j = JSON.parse(reader.result);
              if (j.city) setCity(j.city);
              if (j.income!=null) setIncome(j.income);
              if (j.expenses) setExpenses(j.expenses);
              if (j.sipPct!=null) setSipPct(j.sipPct);
              if (j.mfReturnPct!=null) setMfReturnPct(j.mfReturnPct);
              if (j.licIrrPct!=null) setLicIrrPct(j.licIrrPct);
              if (j.years!=null) setYears(j.years);
              if (j.mode) setMode(j.mode);
              if (j.lumpsumAmount!=null) setLumpsumAmount(j.lumpsumAmount);
              if (j.inflPct!=null) setInflPct(j.inflPct);
              if (j.efMonths!=null) setEfMonths(j.efMonths);
              if (j.useStepUp!=null) setUseStepUp(j.useStepUp);
              if (j.stepUpPct!=null) setStepUpPct(j.stepUpPct);
              if (Array.isArray(j.goals)) setGoals(j.goals);
              alert('Plan imported.');
            } catch(err){ alert('Invalid JSON'); }
          };
          reader.readAsText(file);
        };
        inp.click();
      }

      function exportPDF(){
        const { jsPDF } = window.jspdf || {};
        if (!jsPDF){ alert('PDF library not loaded'); return; }
        const doc = new jsPDF();
        let y = 16;
        doc.setFontSize(14); doc.text('Personal Finance Plan — Summary', 14, y); y+=8;
        doc.setFontSize(10);
        doc.text(`City: ${city}`, 14, y); y+=6;
        doc.text(`Income: ${INR.format(income)} | SIP: ${INR.format(sipMonthly)} (${sipPct}%)`, 14, y); y+=6;
        doc.text(`Expenses: ${INR.format(totalExpenses)} | Leftover: ${INR.format(leftover)}`, 14, y); y+=6;
        doc.text(`MF SIP FV: ${INR.format(sipFvMF_stepUp)} ${useStepUp?`(step-up ${stepUpPct}%/yr)`:''}`, 14, y); y+=6;
        doc.text(`LIC SIP FV: ${INR.format(sipFvLIC)} | MF Lumpsum FV: ${INR.format(lumpFvMF)}`, 14, y); y+=6;
        doc.text(`Inflation: ${inflPct}% → Real MF SIP FV: ${INR.format(realSipFvMF)}`, 14, y); y+=8;

        doc.setFontSize(12); doc.text('Goals', 14, y); y+=6; doc.setFontSize(10);
        if (goals.length === 0){ doc.text('• No goals added', 16, y); y+=6; }
        goals.forEach(g0 => {
          const future = Math.round(goalFutureCost(+g0.present||0, +g0.years||0, +inflPct||0));
          const monthlyNeed = Math.round(monthlyForGoal(future, +g0.years||0, +mfReturnPct||0));
          const line = `• ${g0.name} — future: ${INR.format(future)} | monthly need: ${INR.format(monthlyNeed)} | ${g0.years}y`;
          doc.text(line, 16, y); y+=6;
          if (y > 280){ doc.addPage(); y = 20; }
        });

        const efTarget = Math.round((+efMonths||0) * (+totalExpenses||0));
        const totalGoalMonthly = goals.reduce((a,g)=>{
          const fut = Math.round(goalFutureCost(+g.present||0, +g.years||0, +inflPct||0));
          return a + Math.round(monthlyForGoal(fut, +g.years||0, +mfReturnPct||0));
        },0);

        y+=2; doc.text(`Total monthly needed for goals: ${INR.format(totalGoalMonthly)}`, 14, y);
        y+=6; doc.text(`Emergency fund target: ${INR.format(efTarget)} (${efMonths} months)`, 14, y);

        doc.save(`plan-${city}.pdf`);
      }

      const leftoverClass = leftover < 0 ? 'text-red-600' : 'text-emerald-700';

      // Self-tests
      function approxEqual(a, b, tol = 1e-6) { return Math.abs(a - b) <= Math.max(1, Math.abs(b)) * tol; }
      const tests = [];
      try {
        tests.push({ name: 'Chart.js present', pass: !!window.Chart });
        tests.push({ name: 'FV zero-rate equals sum', pass: sipFutureValue(1000, 1, 0) === 12000 });
        const seq = contributionSeries(1000, 1, 12);
        tests.push({ name: 'Series first label is 0', pass: seq[0].label === '0' });
        tests.push({ name: 'Series includes 1.0y', pass: seq.some(x => x.label === '1.0y') });
        const monthly = 1000, r = 0.12/12; let fvIter = 0; for (let k=1;k<=12;k++){ fvIter = (fvIter + monthly)*(1+r); }
        tests.push({ name: 'FV @12% ~ iterative', pass: approxEqual(sipFutureValue(1000, 1, 12), fvIter, 1e-6) });
      } catch (e) {
        tests.push({ name: 'Tests ran', pass: false, error: String(e) });
      }
      tests.forEach(t => console.log(`[TEST] ${t.pass ? '✓' : '✗'} ${t.name}`, t.error || ''));
      const allPass = tests.every(t => t.pass);

      // Goals computed table (for UI display)
      const goalRows = useMemo(() => goals.map(g => {
        const future = Math.round(goalFutureCost(+g.present||0, +g.years||0, +inflPct||0));
        const monthlyNeed = Math.round(monthlyForGoal(future, +g.years||0, +mfReturnPct||0));
        return { ...g, future, monthlyNeed };
      }), [goals, inflPct, mfReturnPct]);
      const totalGoalMonthly = useMemo(() => goalRows.reduce((a,b)=>a+(+b.monthlyNeed||0),0), [goalRows]);

      // Emergency fund metrics
      const efTarget = useMemo(() => Math.round((+efMonths||0) * (+totalExpenses||0)), [efMonths, totalExpenses]);
      const efMonthsToHit = useMemo(() => {
        const perMonth = Math.max(0, leftover);
        return perMonth > 0 ? Math.ceil(efTarget / perMonth) : Infinity;
      }, [efTarget, leftover]);

      return (
        React.createElement('div', { className: 'max-w-7xl mx-auto p-4 md:p-6' },

          // HEADER
          React.createElement('header', { className: 'mb-6 flex flex-col md:flex-row md:items-end md:justify-between gap-3' },
            React.createElement('div', null,
              React.createElement('h1', { className: 'text-3xl md:text-4xl font-semibold tracking-tight' }, 'Personal Finance Planner (India)'),
              React.createElement('p', { className: 'text-slate-600 mt-1' }, 'City presets • SIP & Lumpsum projections • Mutual Fund vs LIC comparison • Inflation, Step-up SIP, Emergency Fund & Goals.')
            ),
            React.createElement('div', { className: 'flex flex-wrap items-center gap-2' },
              React.createElement('span', { className: `text-xs px-2 py-1 rounded-full ${allPass ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}` }, allPass ? 'Self-checks passed' : 'Self-checks failed'),
              React.createElement('button', { onClick: resetToCity, className: 'px-4 py-2 rounded-xl bg-slate-900 text-white shadow hover:bg-slate-800' }, 'Reset to City Preset'),
              React.createElement('button', { onClick: exportJSON, className: 'px-4 py-2 rounded-xl bg-white border shadow hover:bg-slate-50' }, 'Export Plan JSON'),
              React.createElement('button', { onClick: importJSON, className: 'px-4 py-2 rounded-xl bg-white border shadow hover:bg-slate-50' }, 'Import Plan'),
              React.createElement('button', { onClick: exportPDF, className: 'px-4 py-2 rounded-xl bg-white border shadow hover:bg-slate-50' }, 'Export PDF')
            )
          ),

          React.createElement('section', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-4' },

            // LEFT COLUMN
            React.createElement('div', { className: 'col-span-1 space-y-4' },

              // City
              React.createElement('div', { className: 'bg-white rounded-2xl shadow p-4 md:p-5' },
                React.createElement('label', { className: 'block text-sm font-medium text-slate-700 mb-1' }, 'Select City'),
                React.createElement('select', { className: 'w-full rounded-xl border p-2', value: city, onChange: (e) => setCity(e.target.value) },
                  Object.keys(CITY_PRESETS).map(c => React.createElement('option', { key: c, value: c }, c))
                ),
                React.createElement('p', { className: 'text-xs text-slate-500 mt-2' }, 'Presets are rough starting points — not official cost-of-living data.')
              ),

              // Income & SIP & Returns
              React.createElement('div', { className: 'bg-white rounded-2xl shadow p-4 md:p-5 space-y-3' },
                React.createElement('div', { className: 'flex items-center justify-between' },
                  React.createElement('label', { className: 'text-sm font-medium text-slate-700' }, 'Monthly Income (take-home)'),
                  React.createElement('span', { className: 'text-sm font-semibold' }, INR.format(income || 0))
                ),
                React.createElement('input', { type: 'number', min: 0, className: 'w-full rounded-xl border p-2', value: income, onChange: (e) => setIncome(Number(e.target.value)) }),

                React.createElement('div', { className: 'pt-2 border-t' },
                  React.createElement('div', { className: 'flex items-center justify-between mb-1' },
                    React.createElement('label', { className: 'text-sm font-medium text-slate-700' }, `SIP / Investing (${sipPct}%)`),
                    React.createElement('span', { className: 'text-sm font-semibold' }, INR.format(Math.max(0, sipMonthly)))
                  ),
                  React.createElement('input', { type: 'range', min: 0, max: 60, step: 1, value: sipPct, onChange: (e) => setSipPct(Number(e.target.value)), className: 'w-full' })
                ),

                React.createElement('div', { className: 'grid grid-cols-2 gap-3 pt-3 border-t' },
                  React.createElement('div', null,
                    React.createElement('label', { className: 'text-xs text-slate-600' }, `MF Return: ${mfReturnPct}% p.a.`),
                    React.createElement('input', { type: 'range', min: 0, max: 20, step: 0.5, value: mfReturnPct, onChange: (e) => setMfReturnPct(Number(e.target.value)), className: 'w-full' })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'text-xs text-slate-600' }, `LIC IRR (approx): ${licIrrPct}% p.a.`),
                    React.createElement('input', { type: 'range', min: 0, max: 12, step: 0.25, value: licIrrPct, onChange: (e) => setLicIrrPct(Number(e.target.value)), className: 'w-full' })
                  )
                ),

                React.createElement('div', { className: 'grid grid-cols-2 gap-3 pt-3' },
                  React.createElement('div', null,
                    React.createElement('label', { className: 'text-xs text-slate-600' }, `Years: ${years}`),
                    React.createElement('input', { type: 'range', min: 1, max: 40, step: 1, value: years, onChange: (e) => setYears(Number(e.target.value)), className: 'w-full' })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'text-xs text-slate-600' }, 'Lumpsum Amount (₹)'),
                    React.createElement('input', { type: 'number', min: 0, className: 'w-full rounded-xl border p-2', value: lumpsumAmount, onChange: (e) => setLumpsumAmount(Number(e.target.value)) })
                  )
                ),

                // Inflation & Step-up
                React.createElement('div', { className:'grid grid-cols-2 gap-3 pt-3 border-t' },
                  React.createElement('div', null,
                    React.createElement('label', { className:'text-xs text-slate-600' }, `Inflation: ${inflPct}% p.a.`),
                    React.createElement('input', { type:'range', min:0, max:12, step:0.25, value: inflPct, onChange:e=>setInflPct(Number(e.target.value)), className:'w-full' })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className:'text-xs text-slate-600' }, `Step-up SIP: ${useStepUp ? stepUpPct + '%/yr' : 'Off'}`),
                    React.createElement('div', { className:'flex items-center gap-2' },
                      React.createElement('input', { type:'checkbox', checked:useStepUp, onChange:e=>setUseStepUp(e.target.checked) }),
                      React.createElement('input', { type:'range', min:0, max:20, step:1, value:stepUpPct, onChange:e=>setStepUpPct(Number(e.target.value)), className:'flex-1' })
                    )
                  )
                )
              ),

              // Expenses editor
              React.createElement('div', { className: 'bg-white rounded-2xl shadow p-4 md:p-5' },
                React.createElement('div', { className: 'flex items-center justify-between mb-3' },
                  React.createElement('h3', { className: 'font-semibold' }, 'Monthly Expenses'),
                  React.createElement('button', { onClick: addCategory, className: 'text-sm px-3 py-1.5 rounded-lg bg-slate-900 text-white hover:bg-slate-800' }, '+ Add Category')
                ),
                React.createElement('div', { className: 'space-y-2' },
                  Object.entries(expenses).map(([k, v]) => (
                    React.createElement('div', { key: k, className: 'grid grid-cols-12 gap-2 items-center' },
                      React.createElement('label', { className: 'col-span-5 text-sm' }, k),
                      React.createElement('input', { className: 'col-span-6 rounded-xl border p-2', type: 'number', min: 0, value: v, onChange: (e) => setExpenses({ ...expenses, [k]: Number(e.target.value) }) }),
                      React.createElement('button', { className: 'col-span-1 text-slate-400 hover:text-red-500', title: 'Remove', onClick: () => { const { [k]: _, ...rest } = expenses; setExpenses(rest); } }, '✕')
                    )
                  ))
                )
              )
            ),

            // RIGHT COLUMN
            React.createElement('div', { className: 'col-span-1 lg:col-span-2 space-y-4' },

              // KPI CARDS
              React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-6 gap-4' },
                React.createElement('div', { className: 'bg-white rounded-2xl shadow p-4 md:p-5' },
                  React.createElement('div', { className: 'text-xs uppercase text-slate-500 mb-1' }, 'Total Expenses'),
                  React.createElement('div', { className: 'text-2xl font-semibold' }, INR.format(totalExpenses))
                ),
                React.createElement('div', { className: 'bg-white rounded-2xl shadow p-4 md:p-5' },
                  React.createElement('div', { className: 'text-xs uppercase text-slate-500 mb-1' }, 'Leftover (after SIP)'),
                  React.createElement('div', { className: `text-2xl font-semibold ${leftover < 0 ? 'text-red-600' : 'text-emerald-700'}` }, INR.format(leftover))
                ),
                React.createElement('div', { className: 'bg-white rounded-2xl shadow p-4 md:p-5' },
                  React.createElement('div', { className: 'text-xs uppercase text-slate-500 mb-1' }, 'SIP FV (MF vs LIC)'),
                  React.createElement('div', { className: 'text-base' }, `${INR.format(sipFvMF_stepUp)} vs ${INR.format(sipFvLIC)}`),
                  React.createElement('div', { className: 'text-xs text-slate-500 mt-1' }, `Invested: ${INR.format(investedSipDisplay)} ${useStepUp?'(step-up)':''}`)
                ),
                React.createElement('div', { className: 'bg-white rounded-2xl shadow p-4 md:p-5' },
                  React.createElement('div', { className: 'text-xs uppercase text-slate-500 mb-1' }, 'Lumpsum FV (MF vs LIC)'),
                  React.createElement('div', { className: 'text-base' }, `${INR.format(lumpFvMF)} vs ${INR.format(lumpFvLIC)}`),
                  React.createElement('div', { className: 'text-xs text-slate-500 mt-1' }, `Invested: ${INR.format(lumpsumAmount)}`)
                ),
                React.createElement('div', { className:'bg-white rounded-2xl shadow p-4 md:p-5' },
                  React.createElement('div', { className:'text-xs uppercase text-slate-500 mb-1' }, 'MF SIP FV (Real)'),
                  React.createElement('div', { className:'text-base' }, INR.format(realSipFvMF)),
                  React.createElement('div', { className:'text-xs text-slate-500 mt-1' }, `Inflation @ ${inflPct}%`)
                ),
                React.createElement('div', { className:'bg-white rounded-2xl shadow p-4 md:p-5' },
                  React.createElement('div', { className:'text-xs uppercase text-slate-500 mb-1' }, 'Mode'),
                  React.createElement('div', { className:'text-base' }, mode)
                )
              ),

              // Spending chart
              React.createElement('div', { className: 'bg-white rounded-2xl shadow p-4 md:p-5' },
                React.createElement('h3', { className: 'font-semibold mb-2' }, 'Spending Breakdown'),
                React.createElement(PieChartBox, { labels: pieLabels, values: pieValues })
              ),

              // MODE SWITCH + COMPARISON CHART
              React.createElement('div', { className: 'bg-white rounded-2xl shadow p-4 md:p-5 space-y-3' },
                React.createElement('div', { className: 'flex items-center justify-between flex-wrap gap-3' },
                  React.createElement('h3', { className: 'font-semibold' }, 'Compare Growth: Mutual Fund vs LIC'),
                  React.createElement('div', { className: 'inline-flex rounded-xl bg-slate-100 p-1' },
                    ['SIP','Lumpsum'].map(m => (
                      React.createElement('button', {
                        key: m,
                        onClick: () => setMode(m),
                        className: `px-3 py-1.5 rounded-lg text-sm ${mode===m? 'bg-white shadow font-medium' : 'text-slate-600'}`
                      }, m)
                    ))
                  )
                ),
                React.createElement(LineCompareChart, {
                  labels: compLabels,
                  seriesList: [
                    { label: mode==='SIP' ? (useStepUp ? 'MF (SIP, step-up)' : 'MF (SIP)') : 'MF (Lumpsum)', values: compMFVals },
                    { label: mode==='SIP' ? 'LIC (SIP)' : 'LIC (Lumpsum)', values: compLICVals }
                  ]
                }),
                React.createElement('p', { className: 'text-xs text-slate-500 mt-2' }, 'MF return is a user-set assumption (market-linked). LIC IRR is an approximate yield after bonuses; actual policy IRR varies by product & cashflows.')
              ),

              // Emergency Fund card
              React.createElement('div', { className:'bg-white rounded-2xl shadow p-4 md:p-5 space-y-2' },
                React.createElement('h3', { className:'font-semibold' }, 'Emergency Fund'),
                React.createElement('div', { className:'flex items-center justify-between' },
                  React.createElement('label', { className:'text-sm text-slate-700' }, `Months of expenses (${efMonths})`),
                  React.createElement('input', { type:'range', min:1, max:12, step:1, value:efMonths, onChange:e=>setEfMonths(Number(e.target.value)), className:'w-40' })
                ),
                React.createElement('div', { className:'text-sm' }, `Target: ${INR.format(efTarget)}`),
                React.createElement('div', { className:`text-sm ${efMonthsToHit===Infinity?'text-red-600':'text-slate-700'}` },
                  efMonthsToHit===Infinity ? 'Leftover ≤ 0 — increase income/cut costs to fund EF'
                  : `At current leftover (${INR.format(leftover)}) → ~${efMonthsToHit} month(s) to build`)
              ),

              // Goals mini-planner
              React.createElement('div', { className:'bg-white rounded-2xl shadow p-4 md:p-5 space-y-3' },
                React.createElement('div', { className:'flex items-center justify-between' },
                  React.createElement('h3', { className:'font-semibold' }, 'Goal Planner'),
                  React.createElement('button', { className:'text-sm px-3 py-1.5 rounded-lg bg-slate-900 text-white hover:bg-slate-800',
                    onClick: () => {
                      const name = prompt('Goal name (e.g., “House Down-payment”)');
                      if (!name) return;
                      const present = Number(prompt('Cost today (₹)')||'0');
                      const yrs = Number(prompt('Years to goal')||'5');
                      setGoals([...goals, { id: Date.now(), name, present, years: yrs, priority: 'Med' }]);
                    }}, '+ Add Goal')
                ),
                React.createElement('div', { className:'text-sm text-slate-600' },
                  `Monthly needed for all goals @ MF return: ${INR.format(totalGoalMonthly)}`
                ),
                React.createElement('div', { className:'space-y-2' },
                  goalRows.map(g => React.createElement('div', { key:g.id, className:'grid grid-cols-12 gap-2 items-center' },
                    React.createElement('div', { className:'col-span-4' }, g.name),
                    React.createElement('div', { className:'col-span-3 text-xs text-slate-500' }, `Future: ${INR.format(g.future)}`),
                    React.createElement('div', { className:'col-span-3 text-xs text-slate-500' }, `Monthly: ${INR.format(g.monthlyNeed)}`),
                    React.createElement('button', { className:'col-span-2 text-slate-400 hover:text-red-500',
                      onClick:()=>setGoals(goals.filter(x=>x.id!==g.id)) }, '✕')
                  ))
                ),
                React.createElement('p', { className:'text-xs text-slate-500' },
                  'Tip: Build the emergency fund first, then allocate SIP between goals.')
              )
            )
          ),

          React.createElement('footer', { className: 'mt-6 text-center text-xs text-slate-500' },
            'Made with ❤ for India • Works offline as a single HTML file • Save this page and host on GitHub Pages • By @sanu_r0y'
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>
